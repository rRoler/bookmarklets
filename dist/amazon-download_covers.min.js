javascript:(() => {function e(e,t,n=0){const o=e.match(t);if(o&&o[n])return o[n]}function t(e,t){for(const n in t)e.style.setProperty(n,t[n])}var n=Uint8Array,o=Uint16Array,r=Int32Array,i=new n([0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0,0,0,0]),a=new n([0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13,0,0]),c=function(e,t){for(var n=new o(31),i=0;i<31;++i)n[i]=t+=1<<e[i-1];var a=new r(n[30]);for(i=1;i<30;++i)for(var c=n[i];c<n[i+1];++c)a[c]=c-n[i]<<5|i;return{b:n,r:a}},s=c(i,2),l=s.b,u=s.r;l[28]=258,u[258]=28,c(a,0);for(var f=new o(32768),d=0;d<32768;++d){var h=(43690&d)>>1|(21845&d)<<1;h=(61680&(h=(52428&h)>>2|(13107&h)<<2))>>4|(3855&h)<<4,f[d]=((65280&h)>>8|(255&h)<<8)>>1}var p=new n(288);for(d=0;d<144;++d)p[d]=8;for(d=144;d<256;++d)p[d]=9;for(d=256;d<280;++d)p[d]=7;for(d=280;d<288;++d)p[d]=8;var v=new n(32);for(d=0;d<32;++d)v[d]=5;var g=["unexpected EOF","invalid block type","invalid length/literal","invalid distance","stream finished","no stream handler",,"no callback","invalid UTF-8 data","extra field too long","date not in range 1980-2099","filename too long","stream finishing","invalid zip data"],m=function(e,t,n){var o=new Error(t||g[e]);if(o.code=e,Error.captureStackTrace&&Error.captureStackTrace(o,m),!n)throw o;return o},w=new n(0),y=function(){for(var e=new Int32Array(256),t=0;t<256;++t){for(var n=t,o=9;--o;)n=(1&n&&-306674912)^n>>>1;e[t]=n}return e}(),b=function(e,t,n){for(;n;++t)e[t]=n,n>>>=8},A="undefined"!=typeof TextEncoder&&new TextEncoder,E="undefined"!=typeof TextDecoder&&new TextDecoder;try{E.decode(w,{stream:!0}),1}catch(e){}function k(e,t){if(t){for(var o=new n(e.length),r=0;r<e.length;++r)o[r]=e.charCodeAt(r);return o}if(A)return A.encode(e);var i=e.length,a=new n(e.length+(e.length>>1)),c=0,s=function(e){a[c++]=e};for(r=0;r<i;++r){if(c+5>a.length){var l=new n(c+8+(i-r<<1));l.set(a),a=l}var u=e.charCodeAt(r);u<128||t?s(u):u<2048?(s(192|u>>6),s(128|63&u)):u>55295&&u<57344?(s(240|(u=65536+(1047552&u)|1023&e.charCodeAt(++r))>>18),s(128|u>>12&63),s(128|u>>6&63),s(128|63&u)):(s(224|u>>12),s(128|u>>6&63),s(128|63&u))}return function(e,t,o){(null==t||t<0)&&(t=0),(null==o||o>e.length)&&(o=e.length);var r=new n(o-t);return r.set(e.subarray(t,o)),r}(a,0,c)}var x,S=function(e){var t=0;if(e)for(var n in e){var o=e[n].length;o>65535&&m(9),t+=o+4}return t},T=function(e,t,n,o,r,i,a,c){var s=o.length,l=n.extra,u=c&&c.length,f=S(l);b(e,t,null!=a?33639248:67324752),t+=4,null!=a&&(e[t++]=20,e[t++]=n.os),e[t]=20,t+=2,e[t++]=n.flag<<1|(i<0&&8),e[t++]=r&&8,e[t++]=255&n.compression,e[t++]=n.compression>>8;var d=new Date(null==n.mtime?Date.now():n.mtime),h=d.getFullYear()-1980;if((h<0||h>119)&&m(10),b(e,t,h<<25|d.getMonth()+1<<21|d.getDate()<<16|d.getHours()<<11|d.getMinutes()<<5|d.getSeconds()>>1),t+=4,-1!=i&&(b(e,t,n.crc),b(e,t+4,i<0?-i-2:i),b(e,t+8,n.size)),b(e,t+12,s),b(e,t+14,f),t+=16,null!=a&&(b(e,t,u),b(e,t+6,n.attrs),b(e,t+10,a),t+=14),e.set(o,t),t+=s,f)for(var p in l){var v=l[p],g=v.length;b(e,t,+p),b(e,t+2,g),e.set(v,t+4),t+=4+g}return u&&(e.set(c,t),t+=u),t},z=function(){function e(e){var t;this.filename=e,this.c=(t=-1,{p:function(e){for(var n=t,o=0;o<e.length;++o)n=y[255&n^e[o]]^n>>>8;t=n},d:function(){return~t}}),this.size=0,this.compression=0}return e.prototype.process=function(e,t){this.ondata(null,e,t)},e.prototype.push=function(e,t){this.ondata||m(5),this.c.p(e),this.size+=e.length,t&&(this.crc=this.c.d()),this.process(e,t||!1)},e}(),j=function(){function e(e){this.ondata=e,this.u=[],this.d=1}return e.prototype.add=function(e){var t=this;if(this.ondata||m(5),2&this.d)this.ondata(m(4+8*(1&this.d),0,1),null,!1);else{var o=k(e.filename),r=o.length,i=e.comment,a=i&&k(i),c=r!=e.filename.length||a&&i.length!=a.length,s=r+S(e.extra)+30;r>65535&&this.ondata(m(11,0,1),null,!1);var l=new n(s);T(l,0,e,o,c,-1);var u=[l],f=function(){for(var e=0,n=u;e<n.length;e++){var o=n[e];t.ondata(null,o,!1)}u=[]},d=this.d;this.d=0;var h=this.u.length,p=function(e,t){var n={};for(var o in e)n[o]=e[o];for(var o in t)n[o]=t[o];return n}(e,{f:o,u:c,o:a,t:function(){e.terminate&&e.terminate()},r:function(){if(f(),d){var e=t.u[h+1];e?e.r():t.d=1}d=1}}),v=0;e.ondata=function(o,r,i){if(o)t.ondata(o,r,i),t.terminate();else if(v+=r.length,u.push(r),i){var a=new n(16);b(a,0,134695760),b(a,4,e.crc),b(a,8,v),b(a,12,e.size),u.push(a),p.c=v,p.b=s+v+16,p.crc=e.crc,p.size=e.size,d&&p.r(),d=1}else d&&f()},this.u.push(p)}},e.prototype.end=function(){var e=this;2&this.d?this.ondata(m(4+8*(1&this.d),0,1),null,!0):(this.d?this.e():this.u.push({r:function(){1&e.d&&(e.u.splice(-1,1),e.e())},t:function(){}}),this.d=3)},e.prototype.e=function(){for(var e=0,t=0,o=0,r=0,i=this.u;r<i.length;r++){o+=46+(p=i[r]).f.length+S(p.extra)+(p.o?p.o.length:0)}for(var a,c,s,l,u,f=new n(o+22),d=0,h=this.u;d<h.length;d++){var p=h[d];T(f,e,p,p.f,p.u,-p.c-2,t,p.o),e+=46+p.f.length+S(p.extra)+(p.o?p.o.length:0),t+=p.b}a=f,c=e,s=this.u.length,l=o,u=t,b(a,c,101010256),b(a,c+8,s),b(a,c+10,s),b(a,c+12,l),b(a,c+16,u),this.ondata(null,f,!0),this.d=2},e.prototype.terminate=function(){for(var e=0,t=this.u;e<t.length;e++){t[e].t()}this.d=2},e}(),R="undefined"!=typeof globalThis?globalThis:"undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:{},L={exports:{}};x=L,function(){function e(e,t){return void 0===t?t={autoBom:!1}:"object"!=typeof t&&(console.warn("Deprecated: Expected third argument to be a object"),t={autoBom:!t}),t.autoBom&&/^\s*(?:text\/\S*|application\/xml|\S*\/\S*\+xml)\s*;.*charset\s*=\s*utf-8/i.test(e.type)?new Blob(["\ufeff",e],{type:e.type}):e}function t(e,t,n){var o=new XMLHttpRequest;o.open("GET",e),o.responseType="blob",o.onload=function(){a(o.response,t,n)},o.onerror=function(){console.error("could not download file")},o.send()}function n(e){var t=new XMLHttpRequest;t.open("HEAD",e,!1);try{t.send()}catch(e){}return 200<=t.status&&299>=t.status}function o(e){try{e.dispatchEvent(new MouseEvent("click"))}catch(n){var t=document.createEvent("MouseEvents");t.initMouseEvent("click",!0,!0,window,0,0,0,80,20,!1,!1,!1,!1,0,null),e.dispatchEvent(t)}}var r="object"==typeof window&&window.window===window?window:"object"==typeof self&&self.self===self?self:"object"==typeof R&&R.global===R?R:void 0,i=r.navigator&&/Macintosh/.test(navigator.userAgent)&&/AppleWebKit/.test(navigator.userAgent)&&!/Safari/.test(navigator.userAgent),a=r.saveAs||("object"!=typeof window||window!==r?function(){}:"download"in HTMLAnchorElement.prototype&&!i?function(e,i,a){var c=r.URL||r.webkitURL,s=document.createElement("a");i=i||e.name||"download",s.download=i,s.rel="noopener","string"==typeof e?(s.href=e,s.origin===location.origin?o(s):n(s.href)?t(e,i,a):o(s,s.target="_blank")):(s.href=c.createObjectURL(e),setTimeout((function(){c.revokeObjectURL(s.href)}),4e4),setTimeout((function(){o(s)}),0))}:"msSaveOrOpenBlob"in navigator?function(r,i,a){if(i=i||r.name||"download","string"!=typeof r)navigator.msSaveOrOpenBlob(e(r,a),i);else if(n(r))t(r,i,a);else{var c=document.createElement("a");c.href=r,c.target="_blank",setTimeout((function(){o(c)}))}}:function(e,n,o,a){if((a=a||open("","_blank"))&&(a.document.title=a.document.body.innerText="downloading..."),"string"==typeof e)return t(e,n,o);var c="application/octet-stream"===e.type,s=/constructor/i.test(r.HTMLElement)||r.safari,l=/CriOS\/[\d]+/.test(navigator.userAgent);if((l||c&&s||i)&&"undefined"!=typeof FileReader){var u=new FileReader;u.onloadend=function(){var e=u.result;e=l?e:e.replace(/^data:[^;]*;/,"data:attachment/file;"),a?a.location.href=e:location=e,a=null},u.readAsDataURL(e)}else{var f=r.URL||r.webkitURL,d=f.createObjectURL(e);a?a.location=d:location.href=d,a=null,setTimeout((function(){f.revokeObjectURL(d)}),4e4)}});r.saveAs=a.saveAs=a,x.exports=a}();var M,U=L.exports;function B(e,t,n){return(t=function(e){var t=function(e,t){if("object"!=typeof e||null===e)return e;var n=e[Symbol.toPrimitive];if(void 0!==n){var o=n.call(e,t||"default");if("object"!=typeof o)return o;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string");return"symbol"==typeof t?t:String(t)}(t))in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}class F{constructor(e=0){B(this,"add",(()=>document.body.appendChild(this.element))),B(this,"remove",(()=>this.element.remove()));const n=document.createElement("div");t(n,{"z-index":"1000",position:"fixed",bottom:"0",left:"0",width:"100%",height:"24px","background-color":"#3c3c3c",cursor:"pointer"});const o=document.createElement("div");t(o,{height:"100%","background-color":"#b5e853",transition:"width 200ms"}),this.bar=o,this.update(e),n.appendChild(o),n.addEventListener("click",this.remove),this.element=n}update(e){const n=Math.ceil(parseInt(this.bar.style.getPropertyValue("width"))),o=Math.ceil(e);o>=100?this.remove():n!==o&&o>=0&&t(this.bar,{width:`${o}%`})}}M=()=>{const t=document.querySelectorAll(".itemImageLink"),n=t=>e(t,/(?:[/dp]|$)([A-Z0-9]{10})/,1),o=e=>`https://${window.location.hostname}/images/P/${e}.01.MAIN._SCRM_.jpg`,r=t=>{const n=e=>new Promise(((t,n)=>fetch(e).then((e=>e.blob())).then((e=>{if(e.size<50)throw new Error("cover is smaller than 50 bytes");t(e)})).catch((e=>n("Failed to fetch cover!\n"+e)))));return new Promise(((o,r)=>{n(t).then(o).catch((t=>{const i=document.querySelector("img#igImage")||document.querySelector("img#imgBlkFront")||document.querySelector("img#ebooksImgBlkFront");if(i){const t=/(https?:\/\/.*\/images\/[A-Z]\/[A-Za-z0-9+-]+).*(\.[a-z]+)/,a=e(i.src,t,1),c=e(i.src,t,2);if(a&&c)return n(a+c).then(o).catch(r)}r(t)}))}))};let i=0;const a=e=>{console.error(e),1==++i&&alert(e)};if(t.length>0){const e=Array.from(t).map((e=>n(e.href)));return t.length>4&&confirm("Since you're downloading more than 4 covers, would you like to zip them?")?function(e){const t=new F;t.add();let n=0;const i=[],c=new j(((o,r,c)=>{t.update(n/e.length*100),o?(a("Failed to zip covers!\n"+o),t.remove()):i.push(r),c&&(U.saveAs(new Blob(i,{type:"application/zip"}),"covers.zip"),t.remove())}));function s(e,n){return new Promise((o=>{const i=new FileReader;i.onload=e=>{if(!e.target)return;const t=new Uint8Array(e.target.result),r=new z(`${n}.jpg`);c.add(r),r.push(t,!0),o()},r(e).then((e=>{try{i.readAsArrayBuffer(e)}catch(e){throw new Error("Failed to zip cover!\n"+e)}})).catch((e=>{a(e),t.remove()}))}))}e.forEach((async t=>{if(t){const e=o(t);await s(e,t)}++n>=e.length&&c.end()}))}(e):void s(e)}const c=n(window.location.href);if(!c)return alert("No covers found on this page!");function s(e){e.forEach((e=>{e&&r(o(e)).then((t=>U.saveAs(t,`${e}.jpg`))).catch(a)}))}s([c])},function(e,t){if(!new RegExp(e).test(window.location.hostname))return alert("Bookmarklet executed on a wrong website!");t()}("www.amazon.*",M);})();
