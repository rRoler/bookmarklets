/*!
 * Licensed under MIT: https://github.com/rRoler/bookmarklets/raw/main/LICENSE
 * Third party licenses: https://github.com/rRoler/bookmarklets/raw/main/dist/mangadex-search_missing_links-v2.1.dependencies.txt
 */

javascript:(() => {function t(t){const e=localStorage.getItem(t);if(e)return JSON.parse(e)}const e={titleId:function(t,e){let a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;const n=t.match(e);if(n&&n[a])return n[a]}(window.location.pathname,/\/title\/(?:edit\/)?([-0-9a-f]{20,})/,1),isDraft:/draft=true/.test(window.location.search)},a=(t,e)=>function(t){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"/",a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};const n=new URL(t);n.pathname=e;for(const t in a){const e=a[t];if(Array.isArray(e))for(const a of e)n.searchParams.append(t,a);else n.searchParams.set(t,e.toString())}return n}("https://api.mangadex.org",t,e);function n(){let n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:e.titleId,o=arguments.length>1&&void 0!==arguments[1]?arguments[1]:e.isDraft;const r=t("oidc.user:https://auth.mangadex.org/realms/mangadex:mangadex-frontend-stable")||t("oidc.user:https://auth.mangadex.org/realms/mangadex:mangadex-frontend-canary");return new Promise(((t,e)=>fetch(a(`/manga${o?"/draft/":"/"}${n}`),{headers:{Authorization:o?`${r.token_type} ${r.access_token}`:""}}).then((e=>t(e.json()))).catch(e)))}(function(t){let a=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};(function(t,e){if(!new RegExp(t).test(window.location.hostname))return alert("Bookmarklet executed on the wrong website!");e()})("^mangadex.org|canary.mangadex.dev",(()=>{const n=a.createPage&&/\/create\//.test(window.location.pathname),o="You can execute this bookmarklet only on ";return!a.titlePage||e.titleId||n?!a.editPage||/\/edit\//.test(window.location.pathname)||n?void t():alert(o+"an edit page!"):alert(o+"a title page!")}))})((()=>{const t={al:"https://anilist.co/search/manga?search=",ap:"https://www.anime-planet.com/manga/all?name=",kt:"https://kitsu.io/manga?subtype=manga&text=",mu:"https://www.mangaupdates.com/search.html?search=",mal:"https://myanimelist.net/manga.php?q=",nu:"https://www.novelupdates.com/?s=",bw:"https://bookwalker.jp/search/?qcat=2&word=",amz:"https://www.amazon.co.jp/s?rh=n:466280&k=",ebj:"https://ebookjapan.yahoo.co.jp/search/?keyword=",cdj:"https://www.cdjapan.co.jp/searchuni?term.media_format=BOOK&q="};if(/\/create\/title/.test(window.location.pathname)){const e=prompt("Enter a title to search for");if(!e)return;for(const a in t)window.open(t[a]+e,"_blank","noopener,noreferrer")}else n().then((e=>{e.data.attributes.tags.some((t=>"Adaptation"===t.attributes.name.en))||delete t.nu;const a=Object.keys(t).filter((t=>!e.data.attributes.links[t]));if(a.length<=0)return alert("All links are already added!");const n=e.data.attributes.originalLanguage;let o;try{o=e.data.attributes.altTitles.find((t=>t[n]))}catch(t){console.debug("No alt titles found")}const r=Object.keys(e.data.attributes.title)[0];let s=o?o[n]:e.data.attributes.title[r]||"";s=prompt("Enter a title to search for",s),s&&a.forEach((e=>window.open(t[e]+s,"_blank","noopener,noreferrer")))}))}),{titlePage:!0,createPage:!0});})();
