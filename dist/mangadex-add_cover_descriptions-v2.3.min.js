/*!
 * Licensed under MIT: https://github.com/rRoler/bookmarklets/raw/main/LICENSE
 * Third party licenses: https://github.com/rRoler/bookmarklets/raw/main/dist/mangadex-add_cover_descriptions-v2.3.dependencies.txt
 */

javascript:(() => {function e(e){let t=arguments.length>1&&void 0!==arguments[1]&&arguments[1],n=document.body.querySelector(e);return new Promise((o=>{if(t?!n:n)return o(n);const r=new MutationObserver((()=>{n=document.body.querySelector(e),(t?!n:n)&&(o(n),r.disconnect())}));r.observe(document.body,{childList:!0,subtree:!0})}))}const t=function(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;const o=e.match(t);if(o&&o[n])return o[n]}(window.location.pathname,/\/title\/(?:edit\/)?([-0-9a-f]{20,})/,1);/draft=true/.test(window.location.search);(function(e){let n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};(function(e,t){if(!new RegExp(e).test(window.location.hostname))return alert("Bookmarklet executed on the wrong website!");t()})("^mangadex.org|canary.mangadex.dev",(()=>{const o=n.createPage&&/\/create\//.test(window.location.pathname),r="You can execute this bookmarklet only on ";return!n.titlePage||t||o?!n.editPage||/\/edit\//.test(window.location.pathname)||o?void e():alert(r+"an edit page!"):alert(r+"a title page!")}))})((async()=>{const t=prompt("Enter a description:","Volume $volume Cover from BookWalker");if(!t)return;const n=[],o=Array.from(document.querySelectorAll("div.page-sizer"));for(const e of o)if(/blob:https?:\/\/.*mangadex.*\/+[-0-9a-f]{20,}/.test(e.querySelector(".page").style.getPropertyValue("background-image"))){const o=r(e,t),l=e.parentElement?.querySelector(".volume-edit");l?.dispatchEvent(new MouseEvent("click"));await a(o)&&n.push(e)}if(n.length<=0)return alert("No newly added covers with empty descriptions found!");function r(e,t){const n=e.parentElement?.querySelector(".volume-num input"),o=n?.value,r=e.parentElement?.querySelector(".md-select .md-select-inner-wrap .placeholder-text"),a=r?.innerText,l={volume:o||"No Volume",language:a||"No Language",nl:"\n"};for(const e in l){const n=l[e];n&&(t=t.replaceAll(`$${e}`,n))}return t}function a(t){return new Promise((n=>{const o=".md-modal__box .md-textarea__input";e(o).then((r=>{let a=!0;const l=r?.parentElement?.parentElement?.parentElement?.parentElement?.querySelector("button.primary");r.value?a=!1:r.value=t,r?.dispatchEvent(new InputEvent("input")),setTimeout((()=>{l?.dispatchEvent(new MouseEvent("click")),e(o,!0).then((()=>n(a)))}),2)}))}))}console.log("Added descriptions:",n)}),{titlePage:!0,editPage:!0,createPage:!0});})();
