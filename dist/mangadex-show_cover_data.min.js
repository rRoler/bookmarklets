javascript:(() => {function e(e,t,r=0){const o=e.match(t);if(o&&o[r])return o[r]}function t(e,t=100){const r=[...e],o=[];for(;r.length;)o.push(r.splice(0,t));return o}const r=e(window.location.pathname,/\/title\/+([-0-9a-f]{20,})/,1)||e(window.location.pathname,/\/title\/edit\/+([-0-9a-f]{20,})/,1);function o(e,t,r){return(t=function(e){var t=function(e,t){if("object"!=typeof e||null===e)return e;var r=e[Symbol.toPrimitive];if(void 0!==r){var o=r.call(e,t||"default");if("object"!=typeof o)return o;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string");return"symbol"==typeof t?t:String(t)}(t))in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}class n{constructor(e=0){o(this,"addToDocument",(()=>document.body.appendChild(this.element))),o(this,"removeFromDocument",(()=>this.element.remove()));const t=document.createElement("div");t.style.setProperty("z-index","1000"),t.style.setProperty("position","fixed"),t.style.setProperty("bottom","0"),t.style.setProperty("left","0"),t.style.setProperty("width","100%"),t.style.setProperty("height","24px"),t.style.setProperty("background-color","#3c3c3c"),t.style.setProperty("cursor","pointer");const r=document.createElement("div");r.style.setProperty("height","100%"),r.style.setProperty("background-color","#b5e853"),r.style.setProperty("transition","width 200ms"),this.bar=r,this.update(e),t.appendChild(r),t.addEventListener("click",this.removeFromDocument),this.element=t}update(e){const t=Math.ceil(parseInt(this.bar.style.getPropertyValue("width"))),r=Math.ceil(e);r>=100?this.removeFromDocument():t!==r&&r>=0&&this.bar.style.setProperty("width",`${r}%`)}}((e,t={})=>{(function(e,t){if(!new RegExp(e).test(window.location.hostname))return alert("Bookmarklet executed on a wrong website!");t()})("^mangadex.org|canary.mangadex.dev",(()=>{const o=t.createPage&&/\/create\//.test(window.location.pathname);return!t.titlePage||r||o?!t.editPage||/\/edit\//.test(window.location.pathname)||o?void e():alert("This is not an edit page!"):alert("This is not a title page!")}))})((()=>{const r=100,o=1e3,s=[],i=new Map,a=new Map,l={manga:[],cover:[]},c=new n;if(document.querySelectorAll("img, div").forEach((t=>{const r=t.src||t.style.getPropertyValue("background-image");if(!/\/covers\/+[-0-9a-f]{20,}\/+[-0-9a-f]{20,}[^/]+(?:[?#].*)?$/.test(r)||t.classList.contains("banner-image"))return;const o=e(r,/[-0-9a-f]{20,}/),n=e(r,/([-0-9a-f]{20,}\.[^/.]*)\.[0-9]+\.[^/.?#]*([?#].*)?$/,1)||e(r,/[-0-9a-f]{20,}\.[^/.]*?$/);if(!o||!n)return;const l=e=>{var t;e.has(o)?null===(t=e.get(o))||void 0===t||t.add(n):e.set(o,new Set([n]))};"executed"!==t.getAttribute("cover-data-bookmarklet")?(s.push(t),t.setAttribute("cover-data-bookmarklet","executed"),l(i)):l(a)})),i.size<=0)return document.querySelector('[cover-data-bookmarklet="executed"]')?alert("No new covers were found on this page since the last time this bookmarklet was executed!"):alert("No covers were found on this page!");function d(e,t,r,o){e.setAttribute("cover-data-cover-id",o.id);const n=document.createElement("span"),s=document.createElement("span"),i=function({fill:e="none",viewBox:t="0 0 24 24",stroke:r="currentColor",strokeLinecap:o="round",strokeLinejoin:n="round",d:s=""}){const i=document.createElementNS("http://www.w3.org/2000/svg","svg");i.setAttribute("fill",e),i.setAttribute("viewBox",t),i.setAttribute("stroke",r);const a=document.createElementNS("http://www.w3.org/2000/svg","path");return a.setAttribute("stroke-linecap",o),a.setAttribute("stroke-linejoin",n),a.setAttribute("d",s),i.appendChild(a),i}({d:"M11.25 11.25l.041-.02a.75.75 0 011.063.852l-.708 2.836a.75.75 0 001.063.853l.041-.021M21 12a9 9 0 11-18 0 9 9 0 0118 0zm-9-3.75h.008v.008H12V8.25z"});if(s.classList.add("cover-data-bookmarklet-description"),o.attributes.description){const e=(e,t=!0)=>{const r=e=>e.style.setProperty("display",t?"flex":"none");e.stopPropagation(),e.preventDefault(),e.shiftKey?document.querySelectorAll(".cover-data-bookmarklet-description").forEach((e=>r(e))):r(s)};n.setAttribute("title",o.attributes.description),i.addEventListener("click",e),n.appendChild(i);const t=document.createElement("span");t.innerText=o.attributes.description,t.style.setProperty("max-height","100%"),t.style.setProperty("margin","0.2rem"),t.style.setProperty("text-align","center"),s.style.setProperty("position","absolute"),s.style.setProperty("width","100%"),s.style.setProperty("height","100%"),s.style.setProperty("overflow-y","auto"),s.style.setProperty("display","none"),s.style.setProperty("align-items","center"),s.style.setProperty("justify-content","center"),s.style.setProperty("background-color","var(--md-accent)"),s.style.setProperty("z-index","4"),s.addEventListener("click",(t=>e(t,!1))),s.appendChild(t)}const a=document.createElement("span"),l=document.createElement("span"),c=`${t}x${r}`;l.innerText=c,l.setAttribute("title",c+"\n(click to copy id)"),l.addEventListener("click",(e=>{const t=e=>{navigator.clipboard.writeText(e).then((()=>console.debug(`Copied cover ids: ${e}`)),(()=>console.error(`Failed to copy cover ids: ${e}`))).catch(console.error)};if(e.stopPropagation(),e.preventDefault(),e.shiftKey){const e=[];document.querySelectorAll("[cover-data-cover-id]").forEach((t=>{const r=t.getAttribute("cover-data-cover-id");r&&!e.includes(r)&&e.push(r)})),t(e.join(" "))}else t(o.id)})),a.style.setProperty("position","absolute"),a.style.setProperty("top","0"),a.appendChild(l);const d=document.createElement("div");if(d.style.setProperty("display","flex"),d.style.setProperty("flex-wrap","nowrap"),d.style.setProperty("gap","0.2rem"),e instanceof HTMLImageElement){var p,y;if(a.style.setProperty("padding","0.5rem 0.5rem 1rem"),a.style.setProperty("color","#fff"),a.style.setProperty("left","0"),a.style.setProperty("width","100%"),a.style.setProperty("background","linear-gradient(0deg,transparent,rgba(0,0,0,0.8))"),a.style.setProperty("border-top-right-radius","0.25rem"),a.style.setProperty("border-top-left-radius","0.25rem"),d.style.setProperty("position","absolute"),d.style.setProperty("top","0"),d.style.setProperty("right","0"),d.style.setProperty("padding","0.45rem 0.5rem"),d.style.setProperty("color","#fff"),o.attributes.description)i.setAttribute("stroke-width","1.5"),i.style.setProperty("width","1.5rem"),i.style.setProperty("height","1.5rem"),s.style.setProperty("border-radius","0.25rem"),null===(y=e.parentElement)||void 0===y||y.append(s),d.appendChild(n);null===(p=e.parentElement)||void 0===p||p.append(a,d)}else a.style.setProperty("padding","0 0.2rem"),a.style.setProperty("background-color","var(--md-accent)"),a.style.setProperty("border-bottom-left-radius","4px"),a.style.setProperty("border-bottom-right-radius","4px"),e.appendChild(a),d.style.setProperty("margin-left","0.2rem"),a.style.setProperty("display","flex"),a.style.setProperty("flex-wrap","nowrap"),a.style.setProperty("align-items","center"),o.attributes.description&&(i.setAttribute("stroke-width","2"),i.style.setProperty("width","1.3rem"),i.style.setProperty("height","1.3rem"),e.appendChild(s),d.appendChild(n)),a.appendChild(d),e.appendChild(a)}function p(e,t,n=0){return new Promise(((s,i)=>{const a="cover"===t,l=e.map((e=>a?`manga[]=${e}`:`ids[]=${e}`)).join("&");let c=`https://api.mangadex.org/${t}?${l}&includes[]=cover_art&limit=${r}&contentRating[]=safe&contentRating[]=suggestive&contentRating[]=erotica&contentRating[]=pornographic&offset=${n}`;if(a&&(c=`https://api.mangadex.org/${t}?order[volume]=asc&${l}&limit=${r}&offset=${n}`),n>o)return i(new Error(`Offset is bigger than ${o}:\n ${c}`));fetch(c).then((e=>s(e.json()))).catch(i)}))}c.addToDocument(),i.forEach(((e,t)=>{var r;const o=(null===(r=a.get(t))||void 0===r?void 0:r.size)||0;e.size+o>1?l.cover.push(t):l.manga.push(t)})),function(){const e=[];return new Promise(((r,o)=>{(async function(){for(const r in l){const o="cover"===r,n=t(l[r]);for(const t of n){const n=await p(t,r);if(o){e.push(...n.data);for(let o=n.limit;o<n.total;o+=n.limit){const n=await p(t,r,o);e.push(...n.data)}}else n.data.forEach((t=>{const r=t.relationships.find((e=>"cover_art"===e.type));r&&(r.relationships=[{type:t.type,id:t.id}],e.push(r))}))}}return e})().then(r).catch(o)}))}().then((e=>{let t=0;const r=document.createElement("div");r.style.setProperty("width","fit-content"),r.style.setProperty("height","fit-content"),r.style.setProperty("opacity","0"),r.style.setProperty("position","absolute"),r.style.setProperty("top","-10000px"),r.style.setProperty("z-index","-10000"),r.style.setProperty("pointer-events","none"),document.body.appendChild(r),s.forEach((o=>{const n=o.src||o.style.getPropertyValue("background-image");e.forEach((e=>{const i=e.relationships.find((e=>"manga"===e.type));if(i&&new RegExp(`${i.id}/${e.attributes.fileName}`).test(n)){const n=new Image;r.appendChild(n);try{new ResizeObserver(((i,a)=>{const l=n.naturalWidth,p=n.naturalHeight;l>0&&p>0&&(a.disconnect(),n.remove(),n.src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAAC0lEQVQIW2NgAAIAAAUAAR4f7BQAAAAASUVORK5CYII=",r.children.length<=0&&r.remove(),d(o,l,p,e),c.update(++t/s.length*100))})).observe(n)}catch(i){n.onload=()=>{n.remove(),r.children.length<=0&&r.remove(),d(o,n.naturalWidth,n.naturalHeight,e),c.update(++t/s.length*100)}}n.src=`https://mangadex.org/covers/${i.id}/${e.attributes.fileName}`}}))}))})).catch((e=>{console.error(e),alert("Failed to fetch cover data!")}))}));})();
