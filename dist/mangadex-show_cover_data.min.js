javascript:(() => {function e(e,t,n=0){const r=e.match(t);if(r&&r[n])return r[n]}function t(e,t=100){const n=[...e],r=[];for(;n.length;)r.push(n.splice(0,t));return r}function n(e,t){for(const n in t)e.style.setProperty(n,t[n])}const r=e(window.location.pathname,/\/title\/(?:edit\/)?([-0-9a-f]{20,})/,1),o=(/draft=true/.test(window.location.search),(e,t)=>function(e,t="/",n={}){const r=new URL(e);r.pathname=t;for(const e in n){const t=n[e];if(Array.isArray(t))for(const n of t)r.searchParams.append(e,n);else r.searchParams.set(e,t.toString())}return r}("https://api.mangadex.org",e,t));function i(e,t,n){return(t=function(e){var t=function(e,t){if("object"!=typeof e||null===e)return e;var n=e[Symbol.toPrimitive];if(void 0!==n){var r=n.call(e,t||"default");if("object"!=typeof r)return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string");return"symbol"==typeof t?t:String(t)}(t))in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}class a{constructor(e=0){i(this,"add",(()=>document.body.appendChild(this.element))),i(this,"remove",(()=>this.element.remove()));const t=document.createElement("div");n(t,{"z-index":"1000",position:"fixed",bottom:"0",left:"0",width:"100%",height:"24px","background-color":"#3c3c3c",cursor:"pointer"});const r=document.createElement("div");n(r,{height:"100%","background-color":"#b5e853",transition:"width 200ms"}),this.bar=r,this.update(e),t.appendChild(r),t.addEventListener("click",this.remove),this.element=t}update(e){const t=Math.ceil(parseInt(this.bar.style.getPropertyValue("width"))),r=Math.ceil(e);r>=100?this.remove():t!==r&&r>=0&&n(this.bar,{width:`${r}%`})}}((e,t={})=>{(function(e,t){if(!new RegExp(e).test(window.location.hostname))return alert("Bookmarklet executed on the wrong website!");t()})("^mangadex.org|canary.mangadex.dev",(()=>{const n=t.createPage&&/\/create\//.test(window.location.pathname),o="You can execute this bookmarklet only on ";return!t.titlePage||r||n?!t.editPage||/\/edit\//.test(window.location.pathname)||n?void e():alert(o+"an edit page!"):alert(o+"a title page!")}))})((()=>{const r=100,i=1e3,c=[],s=new Map,d=new Map,l={manga:[],cover:[]},u=new a;if(document.querySelectorAll("img, div").forEach((t=>{const n=t.src||t.style.getPropertyValue("background-image");if(!/\/covers\/+[-0-9a-f]{20,}\/+[-0-9a-f]{20,}[^/]+(?:[?#].*)?$/.test(n)||t.classList.contains("banner-image"))return;const r=e(n,/[-0-9a-f]{20,}/),o=e(n,/([-0-9a-f]{20,}\.[^/.]*)\.[0-9]+\.[^/.?#]*([?#].*)?$/,1)||e(n,/[-0-9a-f]{20,}\.[^/.]*?$/);if(!r||!o)return;const i=e=>{var t;e.has(r)?null===(t=e.get(r))||void 0===t||t.add(o):e.set(r,new Set([o]))};"executed"!==t.getAttribute("cover-data-bookmarklet")?(c.push(t),t.setAttribute("cover-data-bookmarklet","executed"),i(s)):i(d)})),s.size<=0)return document.querySelector('[cover-data-bookmarklet="executed"]')?alert("No new covers were found on this page since the last time this bookmarklet was executed!"):alert("No covers were found on this page!");function p(e,t,r,o){e.setAttribute("cover-data-cover-id",o.id);const i=document.createElement("span"),a=document.createElement("span"),c=function({fill:e="none",viewBox:t="0 0 24 24",stroke:n="currentColor",strokeLinecap:r="round",strokeLinejoin:o="round",d:i=""}){const a=document.createElementNS("http://www.w3.org/2000/svg","svg");a.setAttribute("fill",e),a.setAttribute("viewBox",t),a.setAttribute("stroke",n);const c=document.createElementNS("http://www.w3.org/2000/svg","path");return c.setAttribute("stroke-linecap",r),c.setAttribute("stroke-linejoin",o),c.setAttribute("d",i),a.appendChild(c),a}({d:"M11.25 11.25l.041-.02a.75.75 0 011.063.852l-.708 2.836a.75.75 0 001.063.853l.041-.021M21 12a9 9 0 11-18 0 9 9 0 0118 0zm-9-3.75h.008v.008H12V8.25z"});if(a.classList.add("cover-data-bookmarklet-description"),o.attributes.description){const e=(e,t=!0)=>{const r=e=>n(e,{display:t?"flex":"none"});e.stopPropagation(),e.preventDefault(),e.shiftKey?document.querySelectorAll(".cover-data-bookmarklet-description").forEach((e=>r(e))):r(a)};i.setAttribute("title",o.attributes.description),c.addEventListener("click",e),i.appendChild(c);const t=document.createElement("span");t.innerText=o.attributes.description,n(t,{"max-height":"100%",margin:"0.2rem","text-align":"center"}),n(a,{position:"absolute",width:"100%",height:"100%","overflow-y":"auto",display:"none","align-items":"center","justify-content":"center","background-color":"rgb(var(--md-accent))","z-index":"4"}),a.addEventListener("click",(t=>e(t,!1))),a.appendChild(t)}const s=document.createElement("span"),d=document.createElement("span"),l=`${t}x${r}`;d.innerText=l,d.setAttribute("title",l+"\n(click to copy id)"),d.addEventListener("click",(e=>{const t=e=>{navigator.clipboard.writeText(e).then((()=>console.debug(`Copied cover ids: ${e}`)),(()=>console.error(`Failed to copy cover ids: ${e}`))).catch(console.error)};if(e.stopPropagation(),e.preventDefault(),e.shiftKey){const e=[];document.querySelectorAll("[cover-data-cover-id]").forEach((t=>{const n=t.getAttribute("cover-data-cover-id");n&&!e.includes(n)&&e.push(n)})),t(e.join(" "))}else t(o.id)})),n(s,{position:"absolute",top:"0"}),s.appendChild(d);const u=document.createElement("div");var p,m;(n(u,{display:"flex","flex-wrap":"nowrap",gap:"0.2rem"}),e instanceof HTMLImageElement)?(n(s,{padding:"0.5rem 0.5rem 1rem",color:"#fff",left:"0",width:"100%",background:"linear-gradient(0deg,transparent,rgba(0,0,0,0.8))","border-top-right-radius":"0.25rem","border-top-left-radius":"0.25rem"}),null===(p=e.parentElement)||void 0===p||p.appendChild(s),o.attributes.description&&(n(u,{position:"absolute",top:"0",right:"0",padding:"0.45rem 0.5rem",color:"#fff"}),n(c,{width:"1.5rem",height:"1.5rem"}),c.setAttribute("stroke-width","1.5"),n(a,{"border-radius":"0.25rem"}),u.appendChild(i),null===(m=e.parentElement)||void 0===m||m.append(u,a))):(n(s,{padding:"0 0.2rem","background-color":"rgb(var(--md-accent))","border-bottom-left-radius":"4px","border-bottom-right-radius":"4px"}),e.appendChild(s),n(u,{"margin-left":"0.2rem"}),n(s,{display:"flex","flex-wrap":"nowrap","align-items":"center"}),o.attributes.description&&(c.setAttribute("stroke-width","2"),n(c,{width:"1.3rem",height:"1.3rem"}),e.appendChild(a),u.appendChild(i),s.appendChild(u)),e.appendChild(s))}function m(e,t,n=0){return new Promise(((a,c)=>{const s="cover"===t;if(n>i)return c(new Error(`Offset is bigger than ${i}!`));s?function({mangaIds:e,order:t={},offset:n=0,limit:r=100}){return new Promise(((i,a)=>{const c={offset:n,limit:r,"manga[]":e};null!=t&&t.volume&&(c["order[volume]"]=t.volume),fetch(o("/cover",c)).then((e=>i(e.json()))).catch(a)}))}({mangaIds:e,order:{volume:"asc"},offset:n,limit:r}).then(a).catch(c):function({ids:e,includes:t=[],contentRating:n=[],offset:r=0,limit:i=100}){return new Promise(((a,c)=>{fetch(o("/manga",{offset:r,limit:i,"includes[]":t,"contentRating[]":n,"ids[]":e})).then((e=>a(e.json()))).catch(c)}))}({ids:e,includes:["cover_art"],contentRating:["safe","suggestive","erotica","pornographic"],offset:n,limit:r}).then(a).catch(c)}))}u.add(),s.forEach(((e,t)=>{var n;const r=(null===(n=d.get(t))||void 0===n?void 0:n.size)||0;e.size+r>1?l.cover.push(t):l.manga.push(t)})),function(){const e=[];return new Promise(((n,r)=>{(async function(){for(const n in l){const r="cover"===n,o=t(l[n]);for(const t of o){const o=await m(t,n);if(r){e.push(...o.data);for(let r=o.limit;r<o.total;r+=o.limit){const o=await m(t,n,r);e.push(...o.data)}}else o.data.forEach((t=>{const n=t.relationships.find((e=>"cover_art"===e.type));n&&(n.relationships=[{type:t.type,id:t.id}],e.push(n))}))}}return e})().then(n).catch(r)}))}().then((e=>{let t=0,r=0;const o=document.createElement("div");n(o,{width:"fit-content",height:"fit-content",opacity:"0",position:"absolute",top:"-10000px","z-index":"-10000","pointer-events":"none"}),document.body.appendChild(o),c.forEach((n=>{const i=n.src||n.style.getPropertyValue("background-image");let a;const s=e.find((e=>{if(a=e.relationships.find((e=>"manga"===e.type)),a&&new RegExp(`${a.id}/${e.attributes.fileName}`).test(i))return e}));if(!s||!a)return console.error(`Element changed primary cover image: ${n}`),++r,void h();let d=0;const l=`https://mangadex.org/covers/${a.id}/${s.attributes.fileName}`,m=new Image;function h(){t+r>=c.length&&(u.remove(),r>0&&alert(`${r} cover images failed to load.\n\nReload the page and execute the bookmarklet again!`))}function f(){m.onerror=()=>{console.error(`Cover image failed to load: ${l}`),++r,h()},m.onload=()=>{m.remove(),o.children.length<=0&&o.remove(),p(n,m.naturalWidth,m.naturalHeight,s),u.update(++t/c.length*100),h()}}m.setAttribute("cover-data-bookmarklet","executed"),o.appendChild(m);try{m.onerror=()=>{console.warn(`Cover image failed to load: ${l}.\nRetrying...`),m.removeAttribute("src"),++d>=4&&f(),m.setAttribute("src",l)},new ResizeObserver(((e,r)=>{if(d>=4)return r.disconnect();const i=m.naturalWidth,a=m.naturalHeight;i>0&&a>0&&(r.disconnect(),m.remove(),m.src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAAC0lEQVQIW2NgAAIAAAUAAR4f7BQAAAAASUVORK5CYII=",o.children.length<=0&&o.remove(),p(n,i,a,s),u.update(++t/c.length*100),h())})).observe(m)}catch(e){f()}m.src=l}))})).catch((e=>{console.error(e),alert("Failed to fetch cover data!\n"+e.message)}))}));})();
